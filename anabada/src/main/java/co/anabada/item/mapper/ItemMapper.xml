<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.anabada.item.mapper.ItemMapper">
<!-- ㅇㅈ -->

  <select id="Item" resultType="Item"> 
    select    item_num,
              category_id,
              member_num,
              item_name,
              item_price,
              item_image,
              item_info,
              item_status,
              item_date
      from    item
      where   item_num = 1
  </select>
  
 <select id="ItemList" resultType="Item" >
    select    item_num,
              category_id,
              member_num,
              item_name,
              item_price,
              item_image,
              item_info,
              item_status,
              item_date
      from    item

 </select>
 
 <!-- ㅎㅈ  -->
  <insert id="insertItem" parameterType="Item">
	  INSERT INTO item(category_id
                      ,member_num
                      ,item_name
                      ,item_price
                      ,item_image
                      ,item_info
                      ,item_status)
      VALUES(#{categoryId}
            ,#{memberNum}
            ,#{itemName}
            ,#{itemPrice}
            ,#{itemImage}
            ,#{itemInfo}
	        ,#{itemStatus})
  </insert>
  
  <select id="recentItem" resultType="Item">
	  SELECT item_num
	        ,category_id
	        ,member_num
	        ,item_name
	        ,item_price
	        ,item_image
	        ,item_info
	        ,item_status
	  FROM  (SELECT item.*
	               ,ROW_NUMBER() OVER (ORDER BY item_date DESC) AS recent 
	         FROM   item 
	         WHERE  item_status = '판매중')
	  WHERE recent <![CDATA[<= 10]]>
  </select>
  
  <select id="likeItem" resultType="Item">
      SELECT item.item_num
             ,category_id
             ,member_num
             ,item_name
             ,item_price
             ,item_image
             ,item_info
             ,a.zzim
      FROM      
        (SELECT COUNT(*) AS zzim,
                item_num
         FROM   cart
         GROUP BY item_num
         ORDER BY zzim DESC) a, item
      WHERE a.item_num = item.item_num 
      AND rownum <![CDATA[<= 10]]>
  </select>
  
  <select id="cateList" resultType="co.anabada.item.Category">
      SELECT level
            ,category_id
            ,category_name
            ,parent_category
      FROM  category
      START WITH parent_category IS NULL
      CONNECT BY PRIOR category_id = parent_category
  </select>

 
 <select id="shopList" resultType="Item">
 select  r.review_score AS reviewScore
      ,r.review_comment AS reviewComment
      ,i.item_num AS itemNum
      ,i.category_id AS categoryId
      ,i.item_name AS itemName
      ,i.item_price AS itemPrice
      ,i.item_image AS itemImage
      ,i.item_status AS itemStatus
      ,i.item_date AS itemDate
      ,o.order_status AS orderStatus
FROM  item i  
          JOIN anvd_order o ON o.order_id = i.member_num
          JOIN review r ON r.order_id = o.order_id;
 </select>
 
</mapper>